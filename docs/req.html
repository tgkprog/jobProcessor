<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Job Engine and Job Processor Requirements</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 40px;
            line-height: 1.6;
            background-color: #f4f6f8;
            color: #222;
        }

        h1,
        h2,
        h3 {
            color: #0b5394;
        }

        code {
            background: #eee;
            padding: 2px 6px;
            border-radius: 4px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
            background: white;
        }

        table,
        th,
        td {
            border: 1px solid #ccc;
        }

        th {
            background: #0b5394;
            color: white;
        }

        th,
        td {
            padding: 8px;
            text-align: left;
        }

        section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 6px;
            box-shadow: 0px 0px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>

    <h1>Job Engine and Job Processor Requirements</h1>

    <section>
        <h2>1. Technical Stack</h2>
        <ul>
            <li>Java 11</li>
            <li>Spring Boot (compatible with Java 11, e.g., Spring Boot 2.7.x)</li>
            <li>Maven</li>
            <li>Spring Batch</li>
            <li>Spring Scheduler / Cron Support</li>
            <li>Embedded HTML pages served by same service</li>
        </ul>
    </section>

    <section>
        <h2>2. Architecture Overview</h2>

        <h3>Main Components</h3>
        <ul>
            <li>Job Engine</li>
            <li>Job Processor(s)</li>
            <li>Job Controller</li>
            <li>Thread Pool Executor</li>
            <li>Management Controller</li>
        </ul>

        <h3>Key Concepts</h3>
        <ul>
            <li>Job processors are external JAR files</li>
            <li>Loaded dynamically at startup or runtime</li>
            <li>Configurable via YAML and Controller</li>
        </ul>

    </section>

    <section>
        <h2>3. Job Processor Interface</h2>

        <h3>Method 1: reviewJob</h3>

        <pre>
JobEstimate reviewJob(InputData inputData)
</pre>

        Responsibilities:

        <ul>
            <li>Accept InputData</li>
            <li>Analyze input (dates, parameters, file existence)</li>
            <li>Estimate max processing time</li>
            <li>Return JobEstimate object</li>
        </ul>


        <h3>Method 2: processJob</h3>

        <pre>
OutputData processJob(InputData inputData)
</pre>

        Responsibilities:

        <ul>
            <li>Perform actual job processing</li>
            <li>Return OutputData</li>
        </ul>

    </section>

    <section>

        <h2>4. JobEstimate Structure</h2>

        <table>
            <tr>
                <th>Field</th>
                <th>Description</th>
            </tr>
            <tr>
                <td>maxTimeToProcess</td>
                <td>Estimated max time required</td>
            </tr>
        </table>

    </section>

    <section>

        <h2>5. InputData Structure</h2>

        <table>
            <tr>
                <th>Field</th>
                <th>Description</th>
            </tr>

            <tr>
                <td>inputDataId</td>
                <td>ID of input record</td>
            </tr>

            <tr>
                <td>jobName</td>
                <td>Name of job</td>
            </tr>

            <tr>
                <td>processorClassName</td>
                <td>Fully qualified class name</td>
            </tr>

            <tr>
                <td>comment</td>
                <td>User comment</td>
            </tr>

            <tr>
                <td>notes</td>
                <td>Notes</td>
            </tr>

            <tr>
                <td>parameters</td>
                <td>Map of parameters (String, Number, Date, Object)</td>
            </tr>

            <tr>
                <td>inputFiles</td>
                <td>List of input files</td>
            </tr>

            <tr>
                <td>jobSubmittedDateTime</td>
                <td>Date</td>
            </tr>

            <tr>
                <td>jobSubmittedTime</td>
                <td>Time</td>
            </tr>

            <tr>
                <td>jobSubmittedTimeZone</td>
                <td>TimeZone</td>
            </tr>

        </table>

    </section>

    <section>

        <h2>6. OutputData Structure</h2>

        Includes all InputData plus:

        <table>

            <tr>
                <th>Field</th>
                <th>Description</th>
            </tr>

            <tr>
                <td>jobId</td>
                <td>Generated Job ID</td>
            </tr>

            <tr>
                <td>inputDataId</td>
                <td>Link to input</td>
            </tr>

            <tr>
                <td>outputCommand</td>
                <td>Output command</td>
            </tr>

            <tr>
                <td>outputNote</td>
                <td>Output note</td>
            </tr>

            <tr>
                <td>outputParameters</td>
                <td>Output parameters map</td>
            </tr>

            <tr>
                <td>outputFiles</td>
                <td>Output file list</td>
            </tr>

            <tr>
                <td>jobSubmittedDateTime</td>
                <td>Copied from Input</td>
            </tr>

            <tr>
                <td>jobStartDateTime</td>
                <td>Job start date time</td>
            </tr>

            <tr>
                <td>jobEndDateTime</td>
                <td>Job end date time</td>
            </tr>

            <tr>
                <td>jobStartTimeZone</td>
                <td>Timezone</td>
            </tr>

            <tr>
                <td>jobEndTimeZone</td>
                <td>Timezone</td>
            </tr>

            <tr>
                <td>mainErrorReason</td>
                <td>Main error</td>
            </tr>

            <tr>
                <td>errors</td>
                <td>List of error objects</td>
            </tr>

            <tr>
                <td>status</td>
                <td>SUCCESS / FAILED / TIMED OUT</td>
            </tr>

        </table>

    </section>

    <section>

        <h2>7. Error Object</h2>

        <table>

            <tr>
                <th>Field</th>
                <th>Description</th>
            </tr>

            <tr>
                <td>errorId</td>
                <td>Error ID</td>
            </tr>

            <tr>
                <td>reasonCode</td>
                <td>Error code</td>
            </tr>

            <tr>
                <td>reasonString</td>
                <td>Error message</td>
            </tr>

        </table>

    </section>

    <section>

        <h2>8. Thread Pool Management</h2>

        Configured via YAML:

        <pre>
jobEngine:
  threadPoolSize: 10
</pre>

        Controller Features:

        <ul>

            <li>Change thread pool size</li>

            <li>View running jobs</li>

            <li>Cancel specific job</li>

            <li>Cancel all jobs</li>

        </ul>

    </section>

    <section>

        <h2>9. Job Processor Management</h2>

        Defined in YAML:

        <pre>

jobProcessors:

- className: com.test.MyProcessor

  jarPath: /processors/my.jar

  instances: 2

</pre>

        Runtime Controller Operations:

        <ul>

            <li>List Job Processors</li>

            <li>Add Job Processor</li>

            <li>Remove Job Processor</li>

            <li>Reload Job Processor</li>

            <li>Add instances</li>

        </ul>

        Constraints:

        <ul>

            <li>Each instance handles only ONE job at a time</li>

            <li>Max concurrent jobs = min(thread pool, processor instances)</li>

        </ul>

    </section>

    <section>

        <h2>10. Job Timeout Handling</h2>

        Rules:

        <ul>

            <li>Job processor provides maxTimeToProcess</li>

            <li>Job Engine monitors execution time</li>

            <li>If execution time exceeds 150% of maxTimeToProcess</li>

            <li>Job Engine interrupts job</li>

            <li>Status set to TIMED OUT</li>

            <li>Error recorded</li>

        </ul>

    </section>

    <section>

        <h2>11. Dynamic Job Processor Loading</h2>

        Supported:

        <ul>

            <li>Load from external JAR</li>

            <li>Load at startup</li>

            <li>Load at runtime</li>

            <li>Reload same processor</li>

        </ul>

    </section>

    <section>

        <h2>12. Embedded HTML UI</h2>

        Supports:

        <ul>

            <li>View job status</li>

            <li>View job processors</li>

            <li>Manage processors</li>

            <li>Manage thread pool</li>

            <li>View errors</li>

        </ul>

    </section>

    <section>

        <h2>13. Job Lifecycle</h2>

        Flow:

        <ol>

            <li>User submits InputData (via REST API)</li>

            <li>Job Engine calls reviewJob()</li>

            <li>Estimate stored & timeout calculated (150%)</li>

            <li>Job scheduled in Thread Pool</li>

            <li>processJob() called asynchronously</li>

            <li>Job monitored for completion or timeout</li>

            <li>Completed OR Failed OR Timed Out</li>

            <li>OutputData persists to DB</li>

        </ol>

    </section>

</body>

</html>